 
<div class="cmuThread__subject">
	<div class="row">
		<h3>{{ ::vm.originalMessageSubject | htmlUnescape }}</h3>
	</div>
</div>

<div class="cmuThread__controls">
	<div class="row">
        <div class="col--md8 noPaddingLeft">
        	<span community-permissions>
	        	<button class="button--solid col--md2" ng-click="vm.showTopicReply()">${{ forums.message.reply }}$</button>
	        	<button class="button--ghost col--md2">${{ forums.message.subscribe }}$</button>
				<community-drop-down
					class="cmuInput__selectDropdown__container col--md3 noPadding"
	                menu-template-url="directives/mainnavbar/mainnavbar.actions.html"
	                template-ctrl="mainnavbar.currentUser"
	                element-classname="cmuInput__selectDropdown"
	                label="${{ core.actionsText }}$">
	              </community-drop-down>
			</span>
		</div>

		<div class="col--md4 noPaddingRight">
			<community-pager 
			  number-of-pages="vm.numberOfPages"
			  pager-fn="vm.messageThreadFilter">
			</community-pager>
		</div>
    </div>
</div>


<div class="cmuThread__container row">
	<div class="col--md12 noPadding" ng-repeat="message in vm.messageThread" handle-image-error>
		<community-message
			class="cmuMessage 
				   cmuMessage--sidebyside"
			message="message"
			original-message="vm.originalMessage"
			reply-click-fn="vm.showReply"
			show-op="vm.originalMessage.message.insertUser.id"
			thread-filter="vm.messageThreadFilter"
			local-index="$index">
		</community-message>

		<!-- reply -->
		<div class="cmuThread__reply container" ng-if="vm.messageIsBeingRepliedTo(message.id)">
				<div class="col--md12 noPadding">
					<div class="cmuThread__reply__to">${{ core.actions.replyTo }}$ <span class="cmuThread__replyTo__user">{{ ::message.insertUser.login }}</span></div>
					<community-comment-form
						autofocus="true"
						minimal-editor="true"
						reply-button-text="${{ core.actions.postReply }}$" 
						replying-button-text="${{ core.actions.postingReply }}$..." 
						parent-message="message"
						toggle-attribute="vm.currentReply"
						on-success-fn="vm.replyPosted">
					</community-comment-form>
				</div>
			</div>
		</div>
</div>



<div class="cmuThread__controls
			cmuThread__controls--bottom">
	<div class="row">
        <div class="col--md8 noPaddingLeft">
        	<span community-permissions>
	        	<button class="button--solid button-white-on-blue col--md2" ng-click="vm.showTopicReply()">${{ forums.message.reply }}$</button>
	        	<button class="button--ghost button-blue-on-white col--md2">${{ forums.message.subscribe }}$</button>
				<community-drop-down
					class="cmuInput__selectDropdown__container col--md3 noPadding"
	                menu-template-url="directives/mainnavbar/mainnavbar.actions.html"
	                template-ctrl="mainnavbar.currentUser"
	                element-classname="cmuInput__selectDropdown"
	                label="${{ core.actionsText }}$">
	              </community-drop-down>
			</span>
		</div>

		<div class="col--md4 noPaddingRight">
			<community-pager 
			  number-of-pages="vm.numberOfPages"
			  pager-fn="vm.messageThreadFilter">
			</community-pager>
		</div>
	</div>
	<div class="row" ng-if="vm.topicReplyShown">
		<div id="topicReply">
			<community-comment-form
				autofocus="true"
				reply-button-text="${{ core.actions.postReply }}$" 
				replying-button-text="${{ core.actions.postingReply }}$..." 
				parent-message="vm.topicReplyMessage"
				toggle-attribute="vm.topicReplyShown"
				on-success-fn="vm.replyPosted">
			</community-comment-form>
		</div>
	</div>
</div>

<div class="cmuViewingCounter">
	<div class="row">
		<div class="cmuViewingCounter__count">
			5 {{ vm.originalMessage.stats | extractKey : 'currentlyViewing' }} ${{ forums.message.usersViewingThread }}$
		</div>
	</div>
</div>
